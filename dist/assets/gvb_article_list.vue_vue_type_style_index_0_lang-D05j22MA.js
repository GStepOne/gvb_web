import{c as H,i as J,j as ne,k as se,b as ie}from"./article_api-Bg5Wr0vn.js";import{_ as re}from"./gvb_table.vue_vue_type_style_index_0_lang-CggSQlLz.js";import{m as N}from"./mock--dAMb6rl.js";import{i as ue,u as P}from"./image_api-BtMspoFT.js";import{a as z}from"./tag_api-DSfuC_OI.js";import{_ as de}from"./gvb_article_item.vue_vue_type_style_index_0_lang-BIiJ7FTd.js";import{a as j}from"./date-B9d_EV3y.js";import{d as M,k as T,n as K,r as y,a as v,o as O,c as R,b as a,w as o,g as m,t as I,F as Q,e as W,j as U,f as E,q as X,h as D,M as h,u as Y}from"./index-D8gmBzh4.js";import{_ as q}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{E as Z}from"./MdEditor-ro--MMAW.js";const ce={class:"article_update_gvb"},me={class:"banner_image_div"},_e=["alt","src"],pe=["src"],ge={style:{"margin-left":"10px"}},fe=M({__name:"gvb_article_update",props:{visible:{type:Boolean},data:{},title:{},type:{}},emits:["update:visible","ok"],setup(S,{emit:L}){const g=S,{title:k="文章更新",type:w="update"}=g,e=T({id:"",collects_count:N.Random.integer(0,100),digg_count:N.Random.integer(0,100),comment_count:N.Random.integer(0,100),look_count:N.Random.integer(0,100),created_at:j(new Date().toLocaleString()),tags:[]}),V=T({abstract:"",banner_url:"",category:"",collects_count:0,comment_count:0,created_at:"",digg_count:0,id:"",look_count:0,title:""});K(()=>g.data,()=>{Object.assign(e,g.data),console.log(g.type),V.abstract=g.data.abstract,V.banner_url=g.data.banner_url,V.category=g.data.category,V.title=g.data.title,V.id=g.data.id,V.created_at=g.data.created_at},{deep:!0,immediate:!0});const t=y([]),C=y([]);async function $(){let b=await H();t.value=b.data}$();async function _(){let b=await z();C.value=b.data}_();const x=y([]);async function p(){let b=await ue();x.value=b.data}p();const l=L,s=y();async function f(){if(console.log("updateArticleMeta,验证参数，关掉弹框、触发父组件ok事件",w),!await s.value.validate()){if(w==="update"){let i=await J(e);if(i.code){h.error(i.msg);return}h.success(i.msg),l("update:visible",!1),l("ok",e);return}w==="add"&&(l("update:visible",!1),l("ok",e))}}function r(b){const i=x.value.find(A=>A.id===b);e.banner_url=i.path}function d(){const b=N.Random.pick(x.value);e.banner_id=b.id,e.banner_url=b.path}const c=b=>{let i=b.value;if(i){const A=x.value.find(n=>n.id===i);return A?A.path:""}return""};return console.log(new Date().toLocaleDateString()),console.log(new Date().toLocaleTimeString()),(b,i)=>{const A=v("a-input"),n=v("a-form-item"),B=v("a-textarea"),G=v("a-select"),ee=v("a-option"),te=v("a-button"),ae=v("a-date-picker"),le=v("a-form"),oe=v("a-modal");return O(),R("div",ce,[a(oe,{width:"30%",title:D(k),visible:g.visible,"modal-class":"gvb_article_modal_body",onCancel:i[8]||(i[8]=u=>l("update:visible",!1)),onOk:f},{default:o(()=>[a(le,{ref_key:"formRef",ref:s,model:e},{default:o(()=>[a(n,{field:"title",label:"文章标题",rules:[{required:!0,message:"文章标题必填"}],"validate-trigger":["blur"]},{default:o(()=>[a(A,{modelValue:e.title,"onUpdate:modelValue":i[0]||(i[0]=u=>e.title=u),placeholder:"文章标题"},null,8,["modelValue"])]),_:1}),a(n,{field:"abstract",label:"文章简介",rules:[{message:"请输入文章简介"}],"validate-trigger":["blur"]},{default:o(()=>[a(B,{modelValue:e.abstract,"onUpdate:modelValue":i[1]||(i[1]=u=>e.abstract=u),placeholder:"文章简介","auto-size":{minRows:4,maxRows:5}},null,8,["modelValue"])]),_:1}),a(n,{field:"category",label:"文章分类",rules:[{required:!0,message:"请输入文章分类"}],"validate-trigger":["blur"]},{default:o(()=>[a(G,{modelValue:e.category,"onUpdate:modelValue":i[2]||(i[2]=u=>e.category=u),"allow-create":"",placeholder:"文章分类",options:t.value},null,8,["modelValue","options"])]),_:1}),a(n,{field:"tags",label:"文章标签",rules:[{message:"请文章标签"}],"validate-trigger":["blur"]},{default:o(()=>[a(G,{modelValue:e.tags,"onUpdate:modelValue":i[3]||(i[3]=u=>e.tags=u),multiple:"",placeholder:"文章标签",options:C.value},null,8,["modelValue","options"])]),_:1}),a(n,{label:"文章封面"},{default:o(()=>[a(G,{modelValue:e.banner_id,"onUpdate:modelValue":i[4]||(i[4]=u=>e.banner_id=u),placeholder:"选择封面","allow-clear":"",onChange:r},{label:o(({data:u})=>[m("img",{style:{"border-radius":"5px"},width:"40px",height:"40px",src:c(u),alt:""},null,8,pe),m("label",ge,I(u.label),1)]),default:o(()=>[(O(!0),R(Q,null,W(x.value,u=>(O(),E(ee,{value:u.id,key:u.id},{default:o(()=>[m("div",me,[m("img",{height:"20",alt:u.name,src:u.path},null,8,_e),U(" "+I(u.name),1)])]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),a(te,{type:"outline",style:{"margin-left":"10px"},onClick:d},{default:o(()=>[U("随机")]),_:1})]),_:1}),a(n,{field:"link",label:"原文地址",rules:[{message:"原文地址"}],"validate-trigger":["blur"]},{default:o(()=>[a(A,{modelValue:e.link,"onUpdate:modelValue":i[5]||(i[5]=u=>e.link=u),placeholder:"原文地址"},null,8,["modelValue"])]),_:1}),a(n,{field:"source",label:"文章来源",rules:[{message:"文章来源"}],"validate-trigger":["blur"]},{default:o(()=>[a(A,{modelValue:e.source,"onUpdate:modelValue":i[6]||(i[6]=u=>e.source=u),placeholder:"文章来源"},null,8,["modelValue"])]),_:1}),a(n,{field:"created_at",label:"发布时间",rules:[{message:"发布时间"}],"validate-trigger":["blur"]},{default:o(()=>[a(ae,{"show-time":"","allow-clear":"",showNowBtn:"",modelValue:e.created_at,"onUpdate:modelValue":i[7]||(i[7]=u=>e.created_at=u)},null,8,["modelValue"])]),_:1}),e.title&&e.banner_url&&e.category?(O(),E(n,{key:0,label:"预览","content-class":"preview_body"},{default:o(()=>[a(de,{data:e,preview:""},null,8,["data"])]),_:1})):X("",!0)]),_:1},8,["model"])]),_:1},8,["title","visible"])])}}}),F=q(fe,[["__scopeId","data-v-8fdb706d"]]),be={class:"gvb_article_drawer"},ve=M({__name:"gvb_article_drawer",props:{visible:{type:Boolean}},emits:["update:visible","ok"],setup(S,{emit:L}){y("# 写篇文章吧，Sama");const g=Y(),k=y(!1),w=S,e=L;async function V(p,l){let s=[];try{s=await Promise.all(p.map(r=>P(r)))}catch(r){console.error("文章内的图片上传失败",r);return}const f=[];s.forEach(r=>{if(r.code){h.error(r.msg);return}f.push(r.data)}),l(f)}const t=T({});function C(p){Object.assign(t,p)}function $(){}async function _(){if(t.title===""){h.warning("文章标题不能为空");return}if(t.content===""){h.warning("文章内容不能为空");return}t.created_at=j(t.created_at);let p=await ne(t);if(p.code){h.error(p.msg);return}h.success(p.msg),e("update:visible",!1),t.title="",t.content="",t.abstract="",t.link="",t.source="",t.banner_id=void 0,t.banner_url="",t.created_at=j(new Date().toDateString());const l={category:t.category,tags:t.tags,created_at:new Date().toDateString()};sessionStorage.setItem("saveStore",JSON.stringify(l)),e("ok")}function x(){let p=sessionStorage.getItem("saveStore");if(p!==null)try{const l=JSON.parse(p);t.category=l.category,t.tags=l.tags}catch(l){console.error(l)}}return x(),(p,l)=>{const s=v("a-button"),f=v("a-drawer");return O(),R("div",be,[a(F,{visible:k.value,"onUpdate:visible":l[0]||(l[0]=r=>k.value=r),data:t,title:"文章信息",type:"add",onOk:C},null,8,["visible","data"]),a(f,{class:"gvb_article_drawer_inner",width:"85%",visible:w.visible,onOk:$,onCancel:l[4]||(l[4]=r=>e("update:visible",!1)),unmountOnClose:"",title:"发布文章"},{footer:o(()=>[a(s,{onClick:l[2]||(l[2]=r=>e("update:visible",!1))},{default:o(()=>[U("取消")]),_:1}),a(s,{type:"primary",status:"success",onClick:l[3]||(l[3]=r=>k.value=!0)},{default:o(()=>[U("完善信息")]),_:1}),a(s,{type:"primary",onClick:_},{default:o(()=>[U("发布")]),_:1})]),default:o(()=>[m("div",null,[a(D(Z),{modelValue:t.content,"onUpdate:modelValue":l[1]||(l[1]=r=>t.content=r),"on-upload-img":V,theme:D(g).themeString},null,8,["modelValue","theme"])])]),_:1},8,["visible"])])}}}),ye=q(ve,[["__scopeId","data-v-8112398f"]]),ke={class:"gvb_article_drawer"},we=M({__name:"gvb_article_content_drawer",props:{visible:{type:Boolean},id:{}},emits:["update:visible","ok"],setup(S,{emit:L}){const g=Y(),k=y(!1),w=S,e=L;async function V(s,f){let r=[];try{r=await Promise.all(s.map(c=>P(c)))}catch(c){console.error("文章内的图片上传失败",c);return}const d=[];r.forEach(c=>{if(c.code){h.error(c.msg);return}d.push(c.data)}),f(d)}const t=T({content:"",id:"",abstract:"",banner_url:"",banner_id:0,category:"",link:"",source:"",tags:[],title:"",created_at:""}),C=y("add");async function $(){if(console.log("updateArticle，form之后的data",t),t.content===""){h.warning("文章内容不能为空");return}let s=await J(t);if(s.code){h.error(s.msg);return}h.success(s.msg),t.content="",e("update:visible",!1),e("ok")}async function _(){let s=await se(w.id);if(s.code){h.error(s.msg);return}t.content=s.data.content,t.id=s.data.id,Object.assign(t,s.data),t.created_at=j(t.created_at)}K(()=>w.id,()=>{w.id&&_()},{immediate:!0});async function x(){k.value=!0,C.value="update",console.log("alertArticleTitle",C.value)}function p(s){console.log("文章元数据修改完成的ok事件，关闭元数据窗口",s),k.value=!1,Object.assign(t,s)}function l(){console.log("客户点了取消,并不需要更新"),e("update:visible",!1)}return(s,f)=>{const r=v("a-button"),d=v("a-drawer");return O(),R("div",ke,[a(F,{visible:k.value,"onUpdate:visible":f[0]||(f[0]=c=>k.value=c),data:t,title:"文章元信息",type:"update",onOk:p},null,8,["visible","data"]),a(d,{class:"gvb_article_drawer_inner",width:"85%",visible:w.visible,onCancel:f[2]||(f[2]=c=>e("update:visible",!1)),unmountOnClose:"",onClose:l,title:"编辑文章"},{footer:o(()=>[a(r,{onClick:l},{default:o(()=>[U("取消")]),_:1}),a(r,{type:"primary",status:"success",onClick:x},{default:o(()=>[U("修改元数据")]),_:1}),a(r,{type:"primary",onClick:$},{default:o(()=>[U("更新")]),_:1})]),default:o(()=>[m("div",null,[a(D(Z),{modelValue:t.content,"onUpdate:modelValue":f[1]||(f[1]=c=>t.content=c),"on-upload-img":V,theme:D(g).themeString},null,8,["modelValue","theme"])])]),_:1},8,["visible"])])}}}),Ve=q(we,[["__scopeId","data-v-4e459270"]]),Ce={class:"article_list_view"},he={class:"article_data_col"},xe=m("i",{class:"fa fa-thumbs-o-up"},null,-1),Ae=m("i",{class:"fa fa-eye"},null,-1),Oe=m("i",{class:"fa fa-comments"},null,-1),Ue=m("i",{class:"fa fa-star"},null,-1),$e={class:"article_tags_col"},Se=["innerHTML"],Ge=M({__name:"gvb_article_list",props:{is_user:{type:Boolean}},setup(S){y([]);const L=[{title:"文章标题",slotName:"title"},{title:"分类",dataIndex:"category"},{title:"封面",slotName:"banner_url"},{title:"作者",dataIndex:"user_nick_name"},{title:"标签",slotName:"tags"},{title:"文章数据",slotName:"data"},{title:"创作时间",slotName:"created_at"},{title:"操作",slotName:"action"}];y(!1);const g=y(),k=["red","orangered","orange","gold","lime","green","cyan","blue","arcoblue","purple","pinkpurple","magenta","gray"],w=S,{is_user:e=!1}=w,V=T({is_user:e}),t=[{label:"文章分类",column:"key",source:H},{label:"文章标签",column:"tag",source:z}];function C(){console.log("我接收到了ok事件，我是文章列表"),g.value.getList()}const $=y(!1),_=T({id:"",tags:[],abstract:"",banner_id:0,category:"",content:"",link:"",source:"",title:"",banner_url:"",created_at:""});function x(d){$.value=!0,_.abstract=d.abstract,_.banner_id=d.banner_id,_.category=d.category,_.content=d.content,_.link=d.link,_.source=d.source,_.tags=d.tags,_.title=d.title,_.id=d.id,_.banner_url=d.banner_url,_.created_at=d.created_at}const p=y(!1),l=y(!1),s=y(void 0);function f(d){console.log("点击了编辑正文",d.id),l.value=!0,s.value=d.id,_.content=d.content}function r(){console.log("它点了x")}return(d,c)=>{const b=v("a-image"),i=v("a-tag"),A=v("a-button");return O(),R("div",Ce,[a(F,{visible:$.value,"onUpdate:visible":c[0]||(c[0]=n=>$.value=n),data:_,onOk:C},null,8,["visible","data"]),a(ye,{visible:p.value,"onUpdate:visible":c[1]||(c[1]=n=>p.value=n),onOk:C},null,8,["visible"]),s.value?(O(),E(Ve,{key:0,visible:l.value,"onUpdate:visible":c[2]||(c[2]=n=>l.value=n),id:s.value,onClose:r,onOk:C},null,8,["visible","id"])):X("",!0),a(re,{url:D(ie),"delete-url":"/api/article",columns:L,"default-delete":"","add-label":"发布文章","filter-group":t,ref_key:"gvbTable",ref:g,"default-params":V,"search-placeholder":"搜索文章名称、内容、分类",onAdd:c[3]||(c[3]=n=>p.value=!0),"no-confirm":"",onOk:C,onEdit:x},{banner_url:o(({record:n})=>[a(b,{src:n.banner_url,style:{"border-radius":"5px"},height:"50px"},null,8,["src"])]),data:o(({record:n})=>[m("div",he,[m("span",null,[xe,m("span",null,I(n.digg_count),1)]),m("span",null,[Ae,m("span",null,I(n.look_count),1)]),m("span",null,[Oe,m("span",null,I(n.comment_count),1)]),m("span",null,[Ue,m("span",null,I(n.collects_count),1)])])]),tags:o(({record:n})=>[m("div",$e,[(O(!0),R(Q,null,W(n.tags,B=>(O(),E(i,{color:k[D(N.Random).integer(0,12)]},{default:o(()=>[U(I(B),1)]),_:2},1032,["color"]))),256))])]),title:o(({record:n})=>[m("div",{class:"article_title_col",innerHTML:n.title},null,8,Se)]),action_middle:o(({record:n})=>[a(A,{type:"outline",onClick:B=>f(n)},{default:o(()=>[U("编辑正文")]),_:2},1032,["onClick"])]),_:1},8,["url","default-params"])])}}});export{Ge as _};

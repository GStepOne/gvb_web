import{_ as F}from"./gvb_table.vue_vue_type_style_index_0_lang-C7TABh2O.js";import{z as S,d as y,k as O,r as f,a as d,o as _,c as V,b as l,w as n,F as j,e as A,M as U,f as B,g,j as q,t as z,p as D,i as E,h as M}from"./index-BUgfj_ir.js";import{i as H}from"./image_api-T9Id7gjq.js";import{_ as G}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./date-BwahDaeY.js";import"./index-LyQDbr6L.js";function J(s){return S.get("/api/menus",{params:s})}function K(s){return S.post("/api/menus",s)}const N={image_sort_list:[],path:"",title:"",slogan:"",abstract:[],abstract_time:0,banner_time:0,sort:1,abstractString:"",imageIdList:[]};function P(s,b){return S.put("/api/menus/"+s.toString(),b)}const w=s=>(D("data-v-e0b8df56"),s=s(),E(),s),Q=w(()=>g("div",null,"banner图的切换时间",-1)),W=w(()=>g("div",null,"简介切换时间",-1)),X=w(()=>g("div",null,"序号大的在前面",-1)),Y={class:"banner_image_div"},Z=["alt","src"],ee=y({__name:"menu_create",props:{visible:{type:Boolean},record:{}},emits:["update:visible","ok"],setup(s,{emit:b}){const p=b,e=O({image_sort_list:[],path:"",title:"",slogan:"",abstract:[],abstract_time:7,banner_time:7,sort:1,abstractString:"",imageIdList:[],banners:[]}),u=f([]);async function h(){let i=await H();u.value=i.data}h();const m=f(void 0),v=f(),c=s;async function I(){let i=await v.value.validate();if(i)return console.log("参数错误了",i),!1;e.abstract=e.abstractString.split(`
`);let t=[];if(e.imageIdList.length>0)for(let o=0;o<e.imageIdList.length;o++){const L=e.imageIdList[o];t.push({image_id:L,sort:e.imageIdList.length-o})}e.image_sort_list=t;let r;return m.value?(console.log("请求的是更新接口",m.value),r=await P(m.value,e)):(console.log("请求的是新增接口",m.value),r=await K(e)),r.code?(U.error(r.msg),!1):(U.success(r.msg),p("update:visible",!1),p("ok"),Object.assign(e,N),!0)}function x(){Object.assign(e,c.record),e.abstractString=c.record.abstract.join(`
`);const i=[];for(const t of c.record.banners)i.push(t.id);e.imageIdList=i,m.value=c.record.id}return(i,t)=>{const r=d("a-input"),o=d("a-form-item"),L=d("a-textarea"),k=d("a-input-number"),C=d("a-option"),T=d("a-select"),$=d("a-form"),R=d("a-modal");return _(),V("div",null,[l(R,{title:m.value?"编辑菜单":"创建菜单",visible:c.visible,onBeforeOpen:x,onCancel:t[8]||(t[8]=a=>p("update:visible",!1)),"on-before-ok":I},{default:n(()=>[l($,{ref_key:"formRef",ref:v,model:e},{default:n(()=>[l(o,{field:"title",label:"菜单标题",rules:[{required:!0,message:"菜单标题"}],"validate-trigger":["blur"]},{default:n(()=>[l(r,{modelValue:e.title,"onUpdate:modelValue":t[0]||(t[0]=a=>e.title=a),placeholder:"菜单标题"},null,8,["modelValue"])]),_:1}),l(o,{field:"path",label:"菜单路径",rules:[{required:!0,message:"请输入菜单路径"}],"validate-trigger":["blur"]},{default:n(()=>[l(r,{modelValue:e.path,"onUpdate:modelValue":t[1]||(t[1]=a=>e.path=a),placeholder:"菜单路径"},null,8,["modelValue"])]),_:1}),l(o,{field:"slogan",label:"slogan",rules:[{message:"请输入slogan"}],"validate-trigger":["blur"]},{default:n(()=>[l(r,{modelValue:e.slogan,"onUpdate:modelValue":t[2]||(t[2]=a=>e.slogan=a),placeholder:"slogan"},null,8,["modelValue"])]),_:1}),l(o,{field:"abstract",label:"简介",rules:[{message:"请输入菜单简介"}],"validate-trigger":["blur"]},{default:n(()=>[l(L,{modelValue:e.abstractString,"onUpdate:modelValue":t[3]||(t[3]=a=>e.abstractString=a),placeholder:"菜单简介",autoSize:{maxRows:2,minRows:2}},null,8,["modelValue"])]),_:1}),l(o,{label:"bannerT"},{extra:n(()=>[Q]),default:n(()=>[l(k,{modelValue:e.banner_time,"onUpdate:modelValue":t[4]||(t[4]=a=>e.banner_time=a),placeholder:"banner切换时间"},null,8,["modelValue"])]),_:1}),l(o,{label:"abstractT"},{extra:n(()=>[W]),default:n(()=>[l(k,{modelValue:e.abstract_time,"onUpdate:modelValue":t[5]||(t[5]=a=>e.abstract_time=a),placeholder:"简介切换时间"},null,8,["modelValue"])]),_:1}),l(o,{label:"序号"},{extra:n(()=>[X]),default:n(()=>[l(k,{modelValue:e.sort,"onUpdate:modelValue":t[6]||(t[6]=a=>e.sort=a),placeholder:"序号"},null,8,["modelValue"])]),_:1}),l(o,{label:"banner图"},{default:n(()=>[l(T,{multiple:"",modelValue:e.imageIdList,"onUpdate:modelValue":t[7]||(t[7]=a=>e.imageIdList=a),placeholder:"选择banner图","allow-clear":""},{default:n(()=>[(_(!0),V(j,null,A(u.value,a=>(_(),B(C,{value:a.id,key:a.id},{default:n(()=>[g("div",Y,[g("img",{height:"20",alt:a.name,src:a.path},null,8,Z),q(" "+z(a.name),1)])]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title","visible"])])}}}),te=G(ee,[["__scopeId","data-v-e0b8df56"]]),ae={class:"menu_list_view"},le={class:"menu_column_image"},ue=y({__name:"menu_list",setup(s){const b=[{title:"序号",dataIndex:"sort"},{title:"菜单标题",dataIndex:"title"},{title:"路径",dataIndex:"path"},{title:"slogan",dataIndex:"slogan"},{title:"简介",dataIndex:"abstract"},{title:"slogan切换时间",dataIndex:"banner_time"},{title:"简介切换时间",dataIndex:"abstract_time"},{title:"banner",slotName:"banners"},{title:"更新时间",slotName:"created_at"},{title:"操作",slotName:"action"}],p=f(),e=f(!1),u=O({image_sort_list:[],path:"",title:"",slogan:"",abstract:[],abstract_time:0,banner_time:0,sort:1,banners:[]});function h(c){Object.assign(u,c),e.value=!0}function m(){p.value.getList()}function v(){Object.assign(u,N),u.banners=[],u.id=void 0,e.value=!0}return(c,I)=>{const x=d("a-image");return _(),V("div",ae,[l(te,{visible:e.value,"onUpdate:visible":I[0]||(I[0]=i=>e.value=i),onOk:m,record:u},null,8,["visible","record"]),l(F,{url:M(J),columns:b,"default-delete":"","add-label":"创建菜单",ref_key:"gvbTable",ref:p,"delete-url":"/api/menus","search-placeholder":"搜索菜单名称",onAdd:v,onEdit:h,"no-page":"","no-check":"","no-action-group":"","no-confirm":""},{banners:n(({record:i})=>[g("div",le,[(_(!0),V(j,null,A(i.banners,t=>(_(),B(x,{key:t.id,height:"40px",src:t.path},null,8,["src"]))),128))])]),_:1},8,["url"])])}}});export{ue as default};

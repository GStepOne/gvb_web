import{z as k,d as B,k as b,u as N,r as T,a as p,o as f,c as D,F as q,e as E,f as S,w as m,g,b as l,h as u,j as C,t as j,ag as G,q as R,x as H,y as U,a2 as z,O as J,M as o,n as P}from"./index-D8gmBzh4.js";import{r as Q}from"./date-B9d_EV3y.js";import{s as W}from"./gvb_message_record-COz_zSmI.js";import{I as X}from"./index-BHMoaJRD.js";import{I as Y}from"./index-aVw-_qhZ.js";function ft(a){return k.get("/api/article/comments",{params:a})}function Z(a,y){return k.get("/api/comment",{params:{article_id:a.toString(),...y}})}function tt(a){return k.delete("/api/comment",{params:{id:a.toString()}})}function F(a){return k.post("/api/comment",a)}function et(a){return k.put("/api/comment/"+a.toString())}const nt={class:"gvb_comment_list"},ot=["onClick"],at=["onClick"],st={class:"action"},ct=["src"],it={class:"apply_comment"},O=B({__name:"gvb_comment_list",props:{data:{}},emits:["list"],setup(a,{emit:y}){b({});const s=N(),d=T(0);function i(t){t&&(t.isApply=!t.isApply,t.isApply&&J(()=>{var c;document.querySelector(`.comment_apply_ipt_${(c=t.id)==null?void 0:c.toString()} input`).focus()}))}async function h(t){var _;if(!s.isLogin){o.warning("请先登录");return}if(((_=t.applyContent)==null?void 0:_.trim().length)===0){o.warning("回复内容不能为空");return}const e={article_id:t.article_id,content:t.applyContent,parent_comment_id:t.id};let c=await F(e);if(c.code){o.error(c.msg);return}o.success(c.msg),t.applyContent="",d.value=t.id,I()}async function v(t){let e=await tt(t.id);if(e.code){o.error(e.msg);return}o.success(e.msg),I()}const w=y;function I(){w("list")}async function x(t){let e=await et(t.id);if(e.code){o.error(e.msg);return}o.success(e.msg),t.digg_count=t.digg_count+1}function A(t){var e;if(s.userInfo.userId===t.user_id){console.log("不能与自己聊天");return}W(t.user_id,(e=t.user)==null?void 0:e.nick_name)}return(t,e)=>{const c=p("a-popconfirm"),_=p("a-avatar"),V=p("a-input"),L=p("a-button"),K=p("a-comment");return f(),D("div",nt,[(f(!0),D(q,null,E(t.data,n=>{var M;return f(),S(K,{content:n.content,author:(M=n.user)==null?void 0:M.nick_name,datetime:u(Q)(n.created_at)},{actions:m(()=>[g("span",{class:"action",onClick:r=>x(n)},[l(u(X)),C("点赞("+j(n.digg_count)+")",1)],8,ot),g("span",{class:"action",onClick:r=>i(n)},[l(u(Y)),C("回复")],8,at),u(s).isAdmin||u(s).userInfo.userId===n.user_id?(f(),S(c,{key:0,content:"是否删除这条评论?",onOk:r=>v(n)},{default:m(()=>[g("span",st,[l(u(G)),C("删除")])]),_:2},1032,["onOk"])):R("",!0)]),avatar:m(()=>[l(_,{onClick:r=>A(n)},{default:m(()=>{var r;return[g("img",{src:(r=n.user)==null?void 0:r.avatar,alt:""},null,8,ct)]}),_:2},1032,["onClick"])]),default:m(()=>[n.isApply||d.value===n.id?(f(),S(K,{key:0,avatar:u(s).userInfo.avatar,author:u(s).userInfo.nick_name},{content:m(()=>{var r;return[g("div",it,[l(V,{class:H("comment_apply_ipt_"+n.id),onKeydown:U(z($=>h(n),["ctrl"]),["enter"]),placeholder:"回复"+((r=n.user)==null?void 0:r.nick_name),modelValue:n.applyContent,"onUpdate:modelValue":$=>n.applyContent=$,onClick:$=>i(n)},null,8,["class","onKeydown","placeholder","modelValue","onUpdate:modelValue","onClick"]),l(L,{type:"primary",style:{"margin-left":"10px"},onClick:$=>h(n)},{default:m(()=>[C("回复")]),_:2},1032,["onClick"])])]}),_:2},1032,["avatar","author"])):R("",!0),l(O,{data:n.sub_comments,onList:e[0]||(e[0]=r=>w("list"))},null,8,["data"])]),_:2},1032,["content","author","datetime"])}),256))])}}}),rt={class:"gvb_comment_components"},lt={class:"add_comment"},gt=B({__name:"gvb_comment",props:{articleId:{}},setup(a,{expose:y}){const s=a,d=b({list:[],count:0}),i=b({article_id:"",content:"",parent_comment_id:void 0});P(()=>s.articleId,()=>{console.log("传递过来文章id，开始请求文章评论",s.articleId),s.articleId&&(i.article_id=s.articleId,v())},{immediate:!0});const h=b({});async function v(){console.log("获取列表");let e=await Z(s.articleId,h);d.list=e.data.list,d.count=e.data.count}function w(){v()}const I=N();async function x(){if(!I.isLogin){o.warning("请先登录");return}if(i.content.trim().length===0){o.warning("总得说点什么嘛");return}if(i.article_id===""){o.warning("请选择一篇文章");return}let e=await F(i);if(e.code){o.error(e.msg);return}o.success(e.msg),i.content="",v()}const A=T();function t(){A.value.focus()}return y({focus:t}),(e,c)=>{const _=p("a-textarea"),V=p("a-button");return f(),D("div",rt,[g("div",lt,[l(_,{placeholder:"良言一句三冬暖，恶语伤人六月寒",ref_key:"textareaRef",ref:A,onKeydown:U(z(x,["ctrl"]),["enter"]),modelValue:i.content,"onUpdate:modelValue":c[0]||(c[0]=L=>i.content=L),"auto-size":{minRows:6,maxRows:6}},null,8,["onKeydown","modelValue"]),l(V,{onClick:x,type:"primary"},{default:m(()=>[C("发布评论")]),_:1})]),l(O,{data:d.list,onList:w},null,8,["data"])])}}});export{gt as _,ft as c};

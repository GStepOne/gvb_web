import{z as j,d as C,k as L,r as u,a as i,o as R,c as q,b as a,w as r,h as k,ah as B,M as V,u as G,j as E,ai as F,aj as P}from"./index-D8gmBzh4.js";import{r as y}from"./global-DDeb5C-W.js";import{_ as z}from"./gvb_table.vue_vue_type_style_index_0_lang-CggSQlLz.js";import{G as D,s as S}from"./gvb_message_record-COz_zSmI.js";import"./date-B9d_EV3y.js";import"./index-BUns8YUt.js";import"./gvb_message_record.vue_vue_type_style_index_0_lang-jVhx4fLy.js";import"./message_api-BXmMjDx5.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";function H(c){return j.get("/api/role",{params:c})}const J=C({__name:"user_create",props:{visible:{type:Boolean}},emits:["update:visible","ok"],setup(c,{emit:w}){const v=c,o=L({nick_name:"",password:"",role:2,user_name:"",confirm_password:""}),b=u(),U={nick_name:"",password:"",role:0,user_name:"",confirm_password:""},_=u();async function s(d,l){if(d!==o.password)return l("确认密码不一致")}async function x(){if(await b.value.validate())return!1;let l=await B(o);if(l.code){V.error(l.msg);return}return V.success(l.msg),p("update:visible",!1),p("ok"),_.value.getList(),Object.assign(o,U),!0}const p=w;return(d,l)=>{const f=i("a-input"),m=i("a-form-item"),g=i("a-select"),I=i("a-form"),n=i("a-modal");return R(),q("div",null,[a(n,{title:"创建用户",visible:v.visible,"on-before-ok":x},{default:r(()=>[a(I,{ref_key:"formRef",ref:b,model:o},{default:r(()=>[a(m,{field:"user_name",label:"用户名",rules:[{required:!0,message:"请输入用户名"}],"validate-trigger":["blur"]},{default:r(()=>[a(f,{modelValue:o.user_name,"onUpdate:modelValue":l[0]||(l[0]=e=>o.user_name=e),placeholder:"用户名"},null,8,["modelValue"])]),_:1}),a(m,{field:"nick_name",label:"昵称",rules:[{required:!0,message:"请输入昵称"}],"validate-trigger":["blur"]},{default:r(()=>[a(f,{modelValue:o.nick_name,"onUpdate:modelValue":l[1]||(l[1]=e=>o.nick_name=e),placeholder:"昵称"},null,8,["modelValue"])]),_:1}),a(m,{field:"password",label:"密码",rules:[{required:!0,message:"请输入密码"}],"validate-trigger":["blur"]},{default:r(()=>[a(f,{type:"password",modelValue:o.password,"onUpdate:modelValue":l[2]||(l[2]=e=>o.password=e),placeholder:"密码"},null,8,["modelValue"])]),_:1}),a(m,{field:"confirm_password",label:"确认密码",rules:[{required:!0,message:"请输入确认密码"},{validator:s}],"validate-trigger":["blur"]},{default:r(()=>[a(f,{type:"password",modelValue:o.confirm_password,"onUpdate:modelValue":l[3]||(l[3]=e=>o.confirm_password=e),placeholder:"确认密码"},null,8,["modelValue"])]),_:1},8,["rules"]),a(m,{field:"role",label:"权限"},{default:r(()=>[a(g,{modelValue:o.role,"onUpdate:modelValue":l[4]||(l[4]=e=>o.role=e),options:k(y),placeholder:"请选择角色"},null,8,["modelValue","options"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible"])])}}}),oe=C({__name:"user_list",setup(c){const w=[{title:"昵称",dataIndex:"nick_name"},{title:"用户名",dataIndex:"user_name"},{title:"头像",slotName:"avatar"},{title:"邮箱",dataIndex:"email"},{title:"角色",dataIndex:"role"},{title:"IP",dataIndex:"ip"},{title:"注册时间",slotName:"created_at"},{title:"操作",slotName:"action"}],v=u(!1),o=u(0),b=G();function U(n){S(n.id,n.nick_name)}const _=u(!1),s=L({nick_name:"",role:0,user_id:0});function x(n){s.user_id=n.id,s.role=n.role_id,s.nick_name=n.nick_name,_.value=!0,console.log("角色列表",y)}const p=u(!1),d=u();function l(n){}function f(){d.value.getList()}const m=[{label:"角色过滤",value:0,column:"role",source:H}],g=u();async function I(){if(await g.value.validate())return!1;let e=await F(s);if(e.code){V.error(e.msg);return}return V.success(e.msg),d.value.getList(),!0}return(n,e)=>{const N=i("a-input"),A=i("a-form-item"),O=i("a-select"),M=i("a-form"),T=i("a-modal"),$=i("a-avatar");return R(),q("div",null,[a(J,{visible:p.value,"onUpdate:visible":e[0]||(e[0]=t=>p.value=t),onOk:f},null,8,["visible"]),E(" 编辑用户 "),a(T,{title:"编辑用户",visible:_.value,"onUpdate:visible":e[3]||(e[3]=t=>_.value=t),"on-before-ok":I},{default:r(()=>[a(M,{ref_key:"formUpdateRef",ref:g,model:s},{default:r(()=>[a(A,{field:"nick_name",label:"昵称",rules:[{required:!0,message:"请输入昵称"}],"validate-trigger":["blur"]},{default:r(()=>[a(N,{modelValue:s.nick_name,"onUpdate:modelValue":e[1]||(e[1]=t=>s.nick_name=t),placeholder:"昵称"},null,8,["modelValue"])]),_:1}),a(A,{field:"role",label:"权限"},{default:r(()=>[a(O,{modelValue:s.role,"onUpdate:modelValue":e[2]||(e[2]=t=>s.role=t),"allow-clear":!0,options:k(y),placeholder:"选择角色"},null,8,["modelValue","options"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible"]),a(z,{url:k(P),"delete-url":"/api/user_delete",columns:w,"default-delete":"","add-label":"创建用户",limit:10,ref_key:"gvbTable",ref:d,"filter-group":m,"search-placeholder":"搜索用户名和昵称",onAdd:e[4]||(e[4]=t=>p.value=!0),onEdit:x,onRemove:l,"no-confirm":""},{avatar:r(({record:t})=>[a($,{onClick:K=>U(t),imageUrl:t.avatar},null,8,["onClick","imageUrl"])]),_:1},8,["url"]),a(D,{visible:v.value,"onUpdate:visible":e[5]||(e[5]=t=>v.value=t),userId:o.value,nickname:k(b).userInfo.user_name},null,8,["visible","userId","nickname"])])}}});export{oe as default};

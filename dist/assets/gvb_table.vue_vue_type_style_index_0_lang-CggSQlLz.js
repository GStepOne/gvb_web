import{d as le,k as U,r as k,a as f,o as n,c as d,g as v,b as p,w as l,j as b,t as j,h as w,q as m,f as i,F as G,y as se,a6 as g,e as I,M as h,am as re,an as ce,X as ie,ao as ue}from"./index-D8gmBzh4.js";import{a as de}from"./date-B9d_EV3y.js";import{I as pe}from"./index-BUns8YUt.js";const _e={class:"gvb_table"},fe={class:"gvb_table_head"},me={key:0,class:"action_create"},ve={key:1,class:"action_group"},ye={class:"action_search"},ge={key:2,class:"action_filter"},he=v("div",{class:"action_slot"},null,-1),ke={class:"gvb_table_source"},be={class:"gvd_cell_action"},we={key:0,class:"gvb_table_page"},Ve=le({__name:"gvb_table",props:{url:{type:Function},columns:{},limit:{},rowKey:{},addLabel:{},defaultDelete:{type:Boolean},deleteUrl:{},noActionGroup:{type:Boolean},actionGroup:{},noCheck:{type:Boolean},filterGroup:{},noConfirm:{type:Boolean},noAdd:{type:Boolean},noEdit:{type:Boolean},noDelete:{type:Boolean},searchPlaceholder:{},defaultParams:{},noPage:{type:Boolean}},emits:["add","edit","remove"],setup(L,{expose:E,emit:M}){const a=L,{limit:x=10,rowKey:O="id",addLabel:z="添加",searchPlaceholder:T="搜索"}=a,C=U({list:[],count:0}),c=U({page:1,limit:x,key:""}),B=k(!1);async function _(e){e!==void 0&&Object.assign(c,e),B.value=!0;let t=await a.url(c);if(t.code){h.error(t.msg);return}B.value=!1,C.list=t.data.list,C.count=t.data.count}_(a.defaultParams),E({getList:_});function q(){console.log(c),_(c)}function P(){c.page=1,_()}function R(){h.success("刷新成功"),_()}const V=M,y=k([]),X=U({type:"checkbox",showCheckedAll:!0,onlyCurrent:!1}),u=k(void 0),A=k([{label:"批量删除",value:0}]);function H(){if(a.actionGroup)for(let e=0;e<a.actionGroup.length;e++)A.value.push({label:a.actionGroup[e].label,value:e+1,callback:a.actionGroup[e].callback})}H();function F(){if(u.value==="")return;if(u.value===0){if(y.value.length===0){h.warning("请选择要删除的记录");return}S(y.value);return}const e=A.value[u.value];e.callback&&e.callback(y.value).then(t=>{if(t){y.value=[],_();return}})}function J(){V("add")}function Q(e){V("edit",e)}async function W(e){let t=e[O];S([t])}async function S(e){if(a.deleteUrl&&a.defaultDelete){console.log("idList",e);let t=await re(a.deleteUrl,e);if(t.code){h.error(t.msg);return}h.success(t.msg),y.value=[],_(),V("remove",e);return}h.error("尚未配置删除链接")}const D=k([]);async function Y(){if(a.filterGroup)for(let e=0;e<a.filterGroup.length;e++){const t=a.filterGroup[e];let r=[];switch(typeof t.source){case"function":r=(await t.source()).data;break;case"object":r=t.source;break;case"string":r=(await ce(t.source)).data;break}D.value.push({label:t.label,value:e,source:t.source,column:t.column,options:r})}}Y();function Z(e,t){_({[e.column]:t})}return(e,t)=>{const r=f("a-button"),K=f("a-select"),N=f("a-popconfirm"),ee=f("a-input-search"),$=f("a-table-column"),te=f("a-table"),oe=f("a-pagination"),ae=f("a-spin");return n(),d("div",_e,[v("div",fe,[a.noAdd?m("",!0):(n(),d("div",me,[p(r,{type:"primary",onClick:J},{default:l(()=>[b(j(w(z)),1)]),_:1})])),e.noActionGroup?m("",!0):(n(),d("div",ve,[p(K,{placeholder:"操作",style:{width:"120px"},"allow-clear":"",options:A.value,modelValue:u.value,"onUpdate:modelValue":t[0]||(t[0]=o=>u.value=o)},null,8,["options","modelValue"]),a.noConfirm?(n(),d(G,{key:1},[u.value!==void 0&&u.value!==""?(n(),i(r,{key:0,type:"primary",status:"danger",onClick:F},{default:l(()=>[b("执行 ")]),_:1})):m("",!0)],64)):(n(),i(N,{key:0,content:"是否确认执行此操作?",onOk:F},{default:l(()=>[u.value!==void 0&&u.value!==""?(n(),i(r,{key:0,status:"danger",type:"primary"},{default:l(()=>[b("执行")]),_:1})):m("",!0)]),_:1}))])),v("div",ye,[p(ee,{placeholder:w(T),modelValue:c.key,"onUpdate:modelValue":t[1]||(t[1]=o=>c.key=o),onKeydown:se(P,["enter"]),onSearch:P},null,8,["placeholder","modelValue"])]),g(e.$slots,"action_other_search"),D.value.length>0?(n(),d("div",ge,[(n(!0),d(G,null,I(D.value,o=>(n(),i(K,{placeholder:o.label,options:o.options,"allow-clear":"",onChange:s=>Z(o,s)},null,8,["placeholder","options","onChange"]))),256))])):m("",!0),g(e.$slots,"action_slot"),he,v("div",{class:"action_flush",onClick:R},[p(r,null,{default:l(()=>[p(w(pe))]),_:1})])]),p(ae,{class:"gvb_table_data",loading:B.value,tip:"加载中……"},{default:l(()=>[v("div",null,[v("div",ke,[p(te,{"row-key":w(O),columns:a.columns,data:C.list,"row-selection":a.noCheck?void 0:X,selectedKeys:y.value,"onUpdate:selectedKeys":t[2]||(t[2]=o=>y.value=o),pagination:!1},{columns:l(()=>[(n(!0),d(G,null,I(a.columns,o=>(n(),d(G,null,[o.render?(n(),i($,{key:0,title:o.title},{cell:l(s=>[(n(),i(ie(o.render(s))))]),_:2},1032,["title"])):o.slotName?(n(),i($,{key:2,title:o.title},ue({_:2},[o.slotName==="action"?{name:"cell",fn:l(({record:s})=>[v("div",be,[g(e.$slots,"action_left",{record:s}),a.noEdit?m("",!0):(n(),i(r,{key:0,type:"primary",onClick:ne=>Q(s)},{default:l(()=>[b("编辑")]),_:2},1032,["onClick"])),g(e.$slots,"action_middle",{record:s}),a.noDelete?m("",!0):(n(),i(N,{key:1,content:"是否确认删除?",onOk:ne=>W(s)},{default:l(()=>[p(r,{status:"danger",type:"primary"},{default:l(()=>[b("删除")]),_:1})]),_:2},1032,["onOk"])),g(e.$slots,"action_right",{record:s})])]),key:"0"}:o.slotName==="created_at"?{name:"cell",fn:l(({record:s})=>[v("span",null,j(w(de)(s.created_at)),1)]),key:"1"}:{name:"cell",fn:l(({record:s})=>[g(e.$slots,o.slotName,{record:s})]),key:"2"}]),1032,["title"])):(n(),i($,{key:1,title:o.title,"data-index":o.dataIndex},null,8,["title","data-index"]))],64))),256))]),_:3},8,["row-key","columns","data","row-selection","selectedKeys"])]),e.noPage?m("",!0):(n(),d("div",we,[p(oe,{total:C.count,onChange:q,current:c.page,"onUpdate:current":t[3]||(t[3]=o=>c.page=o),"default-page-size":c.limit,"show-total":"","show-jumper":""},null,8,["total","current","default-page-size"])]))])]),_:3},8,["loading"])])}}});export{Ve as _};
